<!DOCTYPE html>

<html lang="en">

<head>
  <title>A Template App</title>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script async src="{{{appclient}}}"></script>
  <link rel="stylesheet" type="text/css" href="styles/style.css" />
</head>

<body>
  <script type="module">
    import { createApp } from 'https://unpkg.com/petite-vue?module';
    var client;
    (async function () {
      client = await app.initialized();
    })();

    function Shorten() {
      return {
        $template: '#shorten-space',
        long_url: '',
        short_url: '',
        async shortenUrl() {
          this.short_url = "shortening using bitly..."

          try {
            let { response } = await client.request.invokeTemplate("shortenLink", {
              body: JSON.stringify({
                long_url: this.long_url,
                cache: true
              })
            });
            let shortenedObj = JSON.parse(response);
            this.short_url = shortenedObj.link;
          } catch (error) {
            this.short_url = "shortening failed..."
            console.error('this went wrong', error);
          }
        }
      }
    }


    createApp({
      Shorten
    }).mount()
  </script>

  <template id="shorten-space">
    <label for="long-url">Long URL</label>
    <input type="text" name="long-url" v-model="long_url" placeholder="https://www.example.com"
      aria-label="long url text">
    <button @click="shortenUrl()">shorten</button>
    <pre>{{short_url}}</pre>
  </template>

  <div v-scope="Shorten()" id="shorten-space"></div>

</body>

<style>
  html {
    box-sizing: border-box;
    font-family: Arial, Helvetica, sans-serif;
  }

  *,
  *:before,
  *:after {
    box-sizing: inherit;
  }
</style>


</html>
