<!DOCTYPE html>

<html lang="en">

<head>
  <title>A Template App</title>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script async src="{{{appclient}}}"></script>
  <script async type="module"
    src="https://cdn.jsdelivr.net/npm/@freshworks/crayons@v4/dist/crayons/crayons.esm.js"></script>
  <script async nomodule src="https://cdn.jsdelivr.net/npm/@freshworks/crayons@v4/dist/crayons/crayons.js"></script>

  <link rel="stylesheet" type="text/css" href="styles/style.css" />
</head>

<body>
  <script type="module">
    import { createApp } from 'https://unpkg.com/petite-vue?module';
    var client;
    (async function () {
      client = await app.initialized();
    })();

    function Shorten() {
      return {
        $template: '#shorten-space',
        long_url: '',
        short_url: '',
        async shortenUrl() {
          this.short_url = "shortening using bitly..."

          try {
            let { response } = await client.request.invokeTemplate("shortenLink", {
              body: JSON.stringify({
                long_url: this.long_url,
                cache: true
              })
            });
            let shortenedObj = JSON.parse(response);
            this.short_url = shortenedObj.link;
          } catch (error) {
            this.short_url = "shortening failed..."
            console.error('this went wrong', error);
          }
        }
      }
    }


    createApp({
      Shorten,
      List
    }).mount()
  </script>

  <template id="shorten-space">
    <div class="inputbox">
      <p>Enter URL to shorten</p>
      <fw-input type="url" required="true" name="long-url" v-model="long_url" placeholder="https://www.example.com"
        aria-label="long url text"></fw-input>
      <fw-button @click="shortenUrl()" color="secondary" size="normal">Shrink</fw-button>
    </div>
    <pre>{{short_url}}</pre>
    <i>{{info}}</i>

    <style>
      .inputbox {
        display: flex;
        flex-flow: row wrap;
        justify-content: space-around;
      }

      fw-input {
        width: 75%
      }
    </style>
  </template>

  <template id="#list-space">

  </template>

  <div v-scope="Shorten()"></div>
  <div v-scope=""></div>

</body>

<style>
  html {
    box-sizing: border-box;
    font-family: Arial, Helvetica, sans-serif;
  }

  *,
  *:before,
  *:after {
    box-sizing: inherit;
  }
</style>

</html>
